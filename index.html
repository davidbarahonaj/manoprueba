<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estado Mano Robótica EMG</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #111;
  color: white;
}

h1 {
  margin-top: 20px;
}

.container {
  display: flex;
  justify-content: center;
  gap: 50px;
  margin-top: 40px;
}

.foco {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: #333;
  box-shadow: 0 0 20px #000;
}

.verde.on {
  background: lime;
  box-shadow: 0 0 40px lime;
}

.rojo.on {
  background: red;
  box-shadow: 0 0 40px red;
}

button {
  margin-top: 30px;
  padding: 12px 25px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>Estado de la Mano Robótica</h1>

<div class="container">
  <div>
    <div id="verde" class="foco verde"></div>
    <p>Mano Cerrada</p>
  </div>

  <div>
    <div id="rojo" class="foco rojo"></div>
    <p>Mano Abierta</p>
  </div>
</div>

<button onclick="conectar()">Conectar ESP32</button>

<script>
let puerto;
let lector;

async function conectar() {
  puerto = await navigator.serial.requestPort();
  await puerto.open({ baudRate: 115200 });

  const decoder = new TextDecoderStream();
  puerto.readable.pipeTo(decoder.writable);
  lector = decoder.readable.getReader();

  leerDatos();
}

async function leerDatos() {
  while (true) {
    const { value, done } = await lector.read();
    if (done) break;

    if (value) {
      // Esperamos formato: emgLP,estado
      let lineas = value.trim().split("\n");
      lineas.forEach(linea => {
        let partes = linea.split(",");
        if (partes.length === 2) {
          let estado = parseInt(partes[1]);
          actualizarFocos(estado);
        }
      });
    }
  }
}

function actualizarFocos(estado) {
  const verde = document.getElementById("verde");
  const rojo  = document.getElementById("rojo");

  verde.classList.remove("on");
  rojo.classList.remove("on");

  if (estado === 50) {
    verde.classList.add("on"); // Mano cerrada
  } else {
    rojo.classList.add("on");  // Mano abierta
  }
}
</script>

</body>
</html>
